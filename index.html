<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Smart PHC Medicine Store Dashboard with e-Aushadhi Usage</title>

<style>
  body {
    font-family: Arial, sans-serif;
    margin:0;
    background: linear-gradient(135deg, #d0f0f0, #b0e5d8);
    color: #333;
    background-image:
          repeating-linear-gradient(
            45deg,
            rgba(255,255,255,0.15),
            rgba(255,255,255,0.15) 10px,
            transparent 10px,
            transparent 20px
          ),
          linear-gradient(135deg, #d0f0f0, #b0e5d8);
  }
  header {
    background: linear-gradient(90deg, #0077b6, #00b894);
    color: white;
    padding: 15px 20px;
    text-align: center;
    font-size: 1.5em;
    font-weight: bold;
  }
  nav {
    display: flex;
    background: #e0f2f1;
    overflow-x: auto;
    border-bottom: 2px solid #ccc;
  }
  nav button {
    flex: 1;
    padding: 12px;
    border: none;
    background: transparent;
    cursor: pointer;
    font-size: 1em;
    transition: background 0.3s;
  }
  nav button.active {
    background: #b2dfdb;
    font-weight: bold;
    border-bottom: 3px solid #0077b6;
  }
  section {
    padding: 20px;
    display: none;
  }
  section.active {
    display: block;
  }
  .card {
    background: white;
    padding: 15px;
    border-radius: 8px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    margin-bottom: 20px;
  }
  .btn {
    background: #00b894;
    color: white;
    border: none;
    padding: 8px 12px;
    margin: 3px;
    border-radius: 5px;
    cursor: pointer;
  }
  .btn:hover {
    background: #019874;
  }
  .search-bar input {
    width: 100%;
    padding: 8px;
    border: 1px solid #ccc;
    border-radius: 5px;
  }
</style>

<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>
<body>

<header>💊 Smart PHC Medicine Store Dashboard with e-Aushadhi Usage</header>

<nav>
  <button class="tab-btn active" data-tab="stock">Medicine Stock</button>
  <button class="tab-btn" data-tab="expiry">Near Expiry Alerts</button>
  <button class="tab-btn" data-tab="scanner">QR Code Scanner</button>
  <button class="tab-btn" data-tab="reports">Reports</button>
  <button class="tab-btn" data-tab="eaushadhi">e-Aushadhi Usage</button>
</nav>

<!-- Existing tabs omitted for brevity -->

<section id="eaushadhi">
  <div class="card">
    <h3>📂 Upload e-Aushadhi Stock-in-Hand Excel</h3>
    <input type="file" id="eaushadhiExcel" accept=".xlsx, .xls" class="btn" />
    <div class="search-bar" style="margin-top:10px;">
      <input type="text" id="eaushadhiSearch" placeholder="🔍 Search medicine..." />
    </div>
    <div style="margin-top:20px;">
      <canvas id="usageChart" width="600" height="300"></canvas>
    </div>
  </div>
</section>

<script>
  // Tab switching
  document.querySelectorAll(".tab-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      document.querySelectorAll(".tab-btn").forEach(b => b.classList.remove("active"));
      document.querySelectorAll("section").forEach(s => s.classList.remove("active"));
      btn.classList.add("active");
      document.getElementById(btn.dataset.tab).classList.add("active");
    });
  });

  let eaushadhiData = [];
  let filteredEauData = [];
  let usageChart;
  const eaushadhiSearch = document.getElementById('eaushadhiSearch');
  const usageChartCtx = document.getElementById('usageChart').getContext('2d');

  // Parse and load Excel data
  document.getElementById('eaushadhiExcel').addEventListener('change', function(e){
    const file = e.target.files[0];
    if(!file) return;

    const reader = new FileReader();
    reader.onload = function(event){
      const data = new Uint8Array(event.target.result);
      const workbook = XLSX.read(data, {type:'array'});
      const firstSheet = workbook.SheetNames[0];
      const worksheet = workbook.Sheets[firstSheet];

      let jsonData = XLSX.utils.sheet_to_json(worksheet, {defval:''});

      // Expected columns: Medicine Name, Quantity Remaining, Date (optional)
      // Adjust keys based on your actual Excel column headers
      eaushadhiData = jsonData.map(row => ({
        medicine: row['Medicine Name'] || row['Medicine'] || row['Item Name'] || '',
        quantity: Number(row['Quantity Remaining'] || row['Qty Remaining'] || row['Quantity'] || 0),
        date: row['Date'] || row['Month'] || '', // optional, if available
      })).filter(r => r.medicine && !isNaN(r.quantity));

      filteredEauData = [...eaushadhiData];
      renderMedicineSelect();
      renderChart();
    }
    reader.readAsArrayBuffer(file);
  });

  // Populate medicine select (for filter)
  function renderMedicineSelect(){
    // We'll use search input instead, so this function can be removed or expanded if dropdown added
  }

  // Filter data by search input
  eaushadhiSearch.addEventListener('input', function(){
    const val = this.value.toLowerCase();
    filteredEauData = eaushadhiData.filter(d => d.medicine.toLowerCase().includes(val));
    renderChart();
  });

  // Render usage chart
  function renderChart(){
    if(usageChart) usageChart.destroy();

    if(filteredEauData.length === 0){
      usageChartCtx.clearRect(0, 0, 600, 300);
      return;
    }

    // Aggregate usage by medicine, summing quantities
    const usageMap = {};
    filteredEauData.forEach(d => {
      usageMap[d.medicine] = (usageMap[d.medicine] || 0) + d.quantity;
    });

    const labels = Object.keys(usageMap);
    const data = Object.values(usageMap);

    usageChart = new Chart(usageChartCtx, {
      type: 'bar',
      data: {
        labels,
        datasets: [{
          label: 'Quantity Remaining',
          data,
          backgroundColor: 'rgba(0, 184, 148, 0.7)',
          borderColor: 'rgba(0, 184, 148, 1)',
          borderWidth: 1
        }]
      },
      options: {
        responsive:true,
        scales: {
          y: {
            beginAtZero:true,
            title: { display: true, text: 'Quantity Remaining' }
          },
          x: {
            title: { display: true, text: 'Medicine' }
          }
        }
      }
    });
  }
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Smart PHC Medicine Store Dashboard</title>
<style>
  body { font-family: Arial, sans-serif; margin:0; background:#f5f7fa; color:#333; }
  header { background: linear-gradient(90deg,#0077b6,#00b894); color:white;
           padding: 12px 16px; display:flex; align-items:center; justify-content:space-between; }
  header h1 { font-size:1.2em; margin:0; }
  header button { background:#ff5252; border:none; color:white; padding:7px 12px;
                  border-radius:4px; cursor:pointer; }
  .fade-in {animation: fadeIn 0.5s ease forwards;}
  .fade-out {animation: fadeOut 0.4s ease forwards;}
  @keyframes fadeIn { from {opacity:0; transform: translateY(8px);} to {opacity:1; transform: translateY(0);} }
  @keyframes fadeOut { from {opacity:1; transform: translateY(0);} to {opacity:0; transform: translateY(8px);} }
  #authSection { max-width:340px; margin:60px auto; background:#e0f7fa; padding:20px; border-radius:8px;
                 text-align:center; box-shadow:0 2px 8px rgba(0,0,0,0.1);}
  #authSection input { width:90%; padding:10px; margin:8px 0; border:1px solid #ccc; border-radius:6px; }
  .btn { background:#00b894; color:white; border:none; padding:10px 14px; margin:6px 0;
         border-radius:6px; cursor:pointer; }
  nav { display:flex; background:#e0f2f1; border-bottom:2px solid #ccc; overflow-x:auto; }
  nav button { flex:1; min-width:120px; padding:10px; border:none; background:transparent; cursor:pointer; }
  nav button.active { background:#b2dfdb; border-bottom:3px solid #0077b6; }
  section { padding:18px; display:none; }
  section.active { display:block; }
  .card { background:white; padding:15px; border-radius:6px; box-shadow:0 1px 4px rgba(0,0,0,0.1);
          margin-bottom:16px; }
  .search-bar input { width:100%; max-width:300px; padding: 8px; }
  table { width:100%; border-collapse:collapse;}
  th,td { padding:8px; border-bottom:1px solid #ddd;}
  th { background:#0077b6; color:white; }
  .alert { padding:8px; background:#ffefef; border:1px solid #e57373; margin-bottom:6px; border-radius:4px; }
  #dashboardContainer { display:none; }
</style>
</head>
<body>

<!-- Login Form -->
<div id="authSection">
  <h2>Login to Dashboard</h2>
  <input type="email" id="authEmail" placeholder="Email" autocomplete="username" />
  <br />
  <input type="password" id="authPass" placeholder="Password" autocomplete="current-password" />
  <br />
  <button id="loginBtn" class="btn">Login</button>
  <div id="authMsg" style="color:#b30000;margin-top:10px;"></div>
</div>

<!-- Dashboard -->
<div id="dashboardContainer">
  <header id="headerBar">
    <h1>ðŸ’Š Smart PHC Dashboard</h1>
    <button id="logoutBtn">Logout</button>
  </header>

  <nav id="navBar">
    <button class="tab-btn active" data-tab="stock">Medicine Stock</button>
    <button class="tab-btn" data-tab="expiry">Near Expiry Alerts</button>
    <button class="tab-btn" data-tab="scanner">QR Scanner</button>
    <button class="tab-btn" data-tab="reports">Reports</button>
  </nav>

  <section id="stock" class="active">
    <div class="card">
      <h3>ðŸ“‚ Upload & Search Medicines</h3>
      <input type="file" id="excelFile" accept=".xlsx, .xls" class="btn" />
      <div class="search-bar">
        <input type="text" id="searchInput" placeholder="Search medicine..." />
      </div>
      <select id="rackFilter" class="btn">
        <option value="">All Racks</option>
        <option value="Rack 1">Rack 1</option>
        <option value="Rack 2">Rack 2</option>
        <option value="Rack 3">Rack 3</option>
      </select>
    </div>
    <div class="card">
      <table id="medicineTable">
        <thead>
          <tr><th>Name</th><th>Rack</th><th>Qty</th><th>Expiry</th></tr>
        </thead>
        <tbody>
          <tr><td>Paracetamol</td><td>Rack 1</td><td>100</td><td>2025-09-01</td></tr>
          <tr><td>Amoxicillin</td><td>Rack 2</td><td>50</td><td>2025-08-20</td></tr>
        </tbody>
      </table>
    </div>
  </section>

  <section id="expiry">
    <div class="card">
      <h3>âš  Near Expiry Medicines (Within 30 Days)</h3>
      <div id="expiryAlerts"></div>
    </div>
  </section>

  <section id="scanner">
    <div class="card">
      <h3>ðŸ“· QR Code Scanner</h3>
      <button class="btn" id="startScanner">Start Camera Scan</button><br>
      <video id="qrVideo" width="300" height="200" style="display:none;border:1px solid #ccc;max-width:100%;"></video>
      <p id="qrResult"></p>
    </div>
  </section>

  <section id="reports">
    <div class="card">
      <h3>ðŸ“Š Export Reports</h3>
      <button class="btn" id="exportExcel">Export to Excel</button>
      <button class="btn" id="exportPDF">Export to PDF</button>
    </div>
  </section>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyBj_9a5ep2lxKru6yEQqNLHqpSZOm7qi-s",
    authDomain: "smart-phc-dashboard.firebaseapp.com",
    projectId: "smart-phc-dashboard",
    storageBucket: "smart-phc-dashboard.firebasestorage.app",
    messagingSenderId: "519246980359",
    appId: "1:519246980359:web:80d2b1dec39076ad2ad1a2",
    measurementId: "G-QQX4EZK7KP"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();

  // Elements
  const authSection = document.getElementById('authSection');
  const dashboard = document.getElementById('dashboardContainer');
  const loginBtn = document.getElementById('loginBtn');
  const logoutBtn = document.getElementById('logoutBtn');
  const authEmail = document.getElementById('authEmail');
  const authPass = document.getElementById('authPass');
  const authMsg = document.getElementById('authMsg');

  document.body.addEventListener('animationend', e =>{
    e.target.classList.remove('fade-in','fade-out');
  });

  auth.onAuthStateChanged(user => {
    if(user){
      authSection.classList.add('fade-out');
      setTimeout(()=>{
        authSection.style.display='none';
        dashboard.style.display='block';
        dashboard.classList.add('fade-in');
        showTab('stock');
      },400);
    } else {
      dashboard.classList.add('fade-out');
      setTimeout(()=>{
        dashboard.style.display='none';
        authSection.style.display='block';
        authSection.classList.add('fade-in');
      },400);
    }
  });

  loginBtn.onclick = () => {
    authMsg.textContent="";
    auth.setPersistence(firebase.auth.Auth.Persistence.SESSION)
    .then(()=> auth.signInWithEmailAndPassword(authEmail.value, authPass.value))
    .catch(err=> authMsg.textContent = err.message);
  };
  logoutBtn.onclick = ()=> auth.signOut();

  document.querySelectorAll('.tab-btn').forEach(btn=>{
    btn.addEventListener('click',()=>{
      document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      showTab(btn.dataset.tab);
    });
  });

  function showTab(tabId){
    document.querySelectorAll('section').forEach(s=>s.style.display='none');
    document.getElementById(tabId).style.display='block';
    if(tabId==='expiry') checkExpiry();
  }

  document.getElementById("searchInput").addEventListener("input", function(){
    const f=this.value.toLowerCase();
    document.querySelectorAll("#medicineTable tbody tr").forEach(r=>{
      r.style.display = r.innerText.toLowerCase().includes(f) ? '' : 'none';
    });
  });
  document.getElementById("rackFilter").addEventListener("change", function(){
    const rack=this.value;
    document.querySelectorAll("#medicineTable tbody tr").forEach(r=>{
      r.style.display = (!rack || r.cells[1].innerText===rack) ? '' : 'none';
    });
  });
  function checkExpiry(){
    const rows=document.querySelectorAll("#medicineTable tbody tr");
    const now=new Date();
    const box=document.getElementById("expiryAlerts");
    box.innerHTML="";
    rows.forEach(r=>{
      const exp=new Date(r.cells[3].innerText);
      const diff=Math.ceil((exp-now)/(1000*60*60*24));
      if(diff<=30){
        box.innerHTML += `<div class="alert">${r.cells[0].innerText} - Expires ${exp.toISOString().split('T')[0]}</div>`;
      }
    });
    if(box.innerHTML==="") box.innerHTML="<div style='color:green;'>No medicine near expiry.</div>";
  }

  // Start/Stop camera and request back camera
  document.getElementById("startScanner").onclick = async function(){
    const video=document.getElementById("qrVideo");
    const qrResult=document.getElementById("qrResult");
    qrResult.textContent="";
    if(video.srcObject){
      video.srcObject.getTracks().forEach(t=>t.stop());
      video.srcObject=null;
      video.style.display='none';
      this.textContent="Start Camera Scan";
      return;
    }
    try {
      const stream=await navigator.mediaDevices.getUserMedia({
        video:{ facingMode: { exact: "environment" } }
      });
      video.srcObject = stream;
      video.style.display='block';
      video.play();
      this.textContent="Stop Camera Scan";
    } catch(err){
      if(err.name==="OverconstrainedError"||err.name==="NotFoundError"){
        try {
          const stream=await navigator.mediaDevices.getUserMedia({ video:true });
          video.srcObject=stream;
          video.style.display='block';
          video.play();
          this.textContent="Stop Camera Scan";
        } catch(e2){
          qrResult.textContent="Camera not available.";
        }
      } else if(err.name==="NotAllowedError"||err.name==="SecurityError"){
        qrResult.textContent="Camera permission denied.";
      } else {
        qrResult.textContent="Error: "+err.message;
      }
    }
  };

  document.getElementById("exportExcel").onclick=()=>alert("Export to Excel integration here.");
  document.getElementById("exportPDF").onclick=()=>alert("Export to PDF integration here.");
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Simple PHC Firebase Demo</title>
</head>
<body>

  <h1>PHC Medicine Store</h1>

  <div id="loginDiv">
    <button id="loginBtn">One Click Login</button>
  </div>

  <div id="appDiv" style="display:none;">
    <h2>Welcome to Medicine Store</h2>

    <label>Medicine Name: <input type="text" id="medName" /></label><br/>
    <label>Quantity: <input type="number" id="medQty" /></label><br/>
    <label>Expiry Date: <input type="date" id="medExpiry" /></label><br/>
    <label>Rack: <input type="text" id="medRack" /></label><br/>
    <button id="addMedBtn">Add Medicine</button>

    <h3>Medicines:</h3>
    <ul id="medicineList"></ul>

    <button id="logoutBtn">Logout</button>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBj_9a5ep2lxKru6yEQqNLHqpSZOm7qi-s",
      authDomain: "smart-phc-dashboard.firebaseapp.com",
      projectId: "smart-phc-dashboard",
      storageBucket: "smart-phc-dashboard.firebasestorage.app",
      messagingSenderId: "519246980359",
      appId: "1:519246980359:web:80d2b1dec39076ad2ad1a2"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    const loginBtn = document.getElementById("loginBtn");
    const logoutBtn = document.getElementById("logoutBtn");
    const addMedBtn = document.getElementById("addMedBtn");
    const loginDiv = document.getElementById("loginDiv");
    const appDiv = document.getElementById("appDiv");
    const medicineList = document.getElementById("medicineList");

    // Show medicines function
    function loadMedicines() {
      medicineList.innerHTML = "";
      db.collection("medicines")
        .where("userId", "==", auth.currentUser.uid)
        .orderBy("createdAt", "desc")
        .get()
        .then(snapshot => {
          if (snapshot.empty) {
            medicineList.innerHTML = "<li>No medicines found.</li>";
            return;
          }
          snapshot.forEach(doc => {
            const med = doc.data();
            const li = document.createElement("li");
            li.textContent = `${med.name} | Qty: ${med.quantity} | Expiry: ${med.expiryDate} | Rack: ${med.rack}`;
            medicineList.appendChild(li);
          });
        })
        .catch(err => {
          medicineList.innerHTML = "<li>Error loading medicines.</li>";
          console.error(err);
        });
    }

    loginBtn.onclick = () => {
      auth.signInAnonymously()
        .catch(e => alert("Login error: " + e.message));
    };

    logoutBtn.onclick = () => {
      auth.signOut();
    };

    addMedBtn.onclick = () => {
      const name = document.getElementById("medName").value.trim();
      const qty = Number(document.getElementById("medQty").value);
      const expiry = document.getElementById("medExpiry").value;
      const rack = document.getElementById("medRack").value.trim();

      if (!name || !qty || !expiry || !rack) {
        alert("सर्व माहिती भरा!");
        return;
      }

      db.collection("medicines").add({
        userId: auth.currentUser.uid,
        name: name,
        quantity: qty,
        expiryDate: expiry,
        rack: rack,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      })
      .then(() => {
        alert("औषध यशस्वीरीत्या जोडले!");
        document.getElementById("medName").value = "";
        document.getElementById("medQty").value = "";
        document.getElementById("medExpiry").value = "";
        document.getElementById("medRack").value = "";
        loadMedicines();
      })
      .catch(e => alert("Error adding medicine: " + e.message));
    };

    auth.onAuthStateChanged(user => {
      if (user) {
        loginDiv.style.display = "none";
        appDiv.style.display = "block";
        loadMedicines();
      } else {
        loginDiv.style.display = "block";
        appDiv.style.display = "none";
        medicineList.innerHTML = "";
      }
    });
  </script>

</body>
  </html>

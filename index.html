<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Smart PHC Medicine Store - Secure Login</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

<!-- External Libraries -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script src="https://unpkg.com/html5-qrcode"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js"></script>

<style>
/* ========== LOGIN STYLES ========== */
body { font-family: Arial, sans-serif; background:#f5fdfc; margin:0; }
.auth-container {
  max-width:360px; margin:80px auto; background:#fff; padding:20px;
  border-radius:8px; box-shadow:0 4px 12px rgba(0,0,0,0.1);
}
.auth-container input {
  width:100%; padding:8px; margin-bottom:10px; border:1px solid #ccc; border-radius:5px;
}
.auth-container button {
  width:100%; padding:10px; background:linear-gradient(90deg,#0077b6,#00b894);
  color:#fff; font-weight:bold; border:none; border-radius:5px; cursor:pointer;
}
.auth-container button:hover { background:#00b894; }

/* ==== DASHBOARD STYLES FROM FINAL VERSION ==== */
header {
  background:linear-gradient(90deg,#0077b6,#00b894); color:#fff;
  padding:15px; text-align:center; font-size:22px; font-weight:bold;
  display:flex; justify-content:space-between; align-items:center;
}
#logoutBtn {
  background:#fff; color:#0077b6; border:none; padding:6px 12px;
  border-radius:5px; cursor:pointer; font-weight:bold;
}
#logoutBtn:hover { background:#ffeaa7; }
nav { display:flex; background-color:#e3f6f5; border-bottom:1px solid #ccc; }
nav button { flex:1; padding:12px; border:none; background:transparent; font-size:16px; cursor:pointer;}
nav button.active { border-bottom:3px solid #0077b6; font-weight:bold; color:#0077b6; }
.tab-content { display:none; padding:20px; }
.tab-content.active { display:block; }
.alert { background:#ffeaa7; padding:10px; margin-bottom:15px; border-left:5px solid #fdcb6e; }

.controls { display:flex; flex-wrap:wrap; gap:18px; align-items:end; margin-bottom:15px; }
.form-group { display:flex; flex-direction:column; }
.form-group label { color:#0077b6; font-size:14px; margin-bottom:4px; font-weight:600; letter-spacing:0.2px; display:flex; align-items:center; gap:5px;}
input[type="file"], input[type="text"], select {
  border-radius:8px; border:1px solid #b0e2e0; padding:6px 10px; font-size:15px;
  background:#e3f6f5; transition:border 0.2s, box-shadow 0.2s;
}
input[type="file"]:hover, input[type="text"]:hover, select:hover {
  border:1.5px solid #00b894; box-shadow:0 1px 3px rgba(0,0,0,0.08);
}
.button-group { flex-direction:row; gap:8px; }
button {
  border-radius:8px; background:linear-gradient(90deg,#0077b6,#00b894);
  border:none; padding:8px 14px; font-size:14px; font-weight:600; cursor:pointer;
  color:#fff; white-space:nowrap;
}
button:hover { background:#00b894; }
table { width:100%; border-collapse:collapse; background:#fff; }
th, td { border:1px solid #ccc; padding:8px; text-align:center; }
th { background:#d0f0ec; }
</style>
</head>
<body>

<!-- Login Screen -->
<div id="loginSection" class="auth-container">
  <h2>Login</h2>
  <input type="email" id="loginEmail" placeholder="Email">
  <input type="password" id="loginPassword" placeholder="Password">
  <button onclick="login()">Login</button>
</div>

<!-- Dashboard -->
<div id="dashboard" style="display:none;">

<header>
  üíä Smart PHC Medicine Store Dashboard
  <button id="logoutBtn" onclick="logout()">Logout</button>
</header>

<!-- ====== NAVIGATION ====== -->
<nav>
  <button class="tab-btn active" data-tab="stock">Medicine Stock</button>
  <button class="tab-btn" data-tab="nearExpiry">Near Expiry</button>
  <button class="tab-btn" data-tab="qr">QR Scanner</button>
  <button class="tab-btn" data-tab="reports">Reports</button>
</nav>

<!-- ====== STOCK TAB ====== -->
<div id="stock" class="tab-content active">
  <div class="alert" id="expiryAlert">No near-expiry medicines.</div>
  <div class="controls">
    <div class="form-group">
      <label for="excelFile">üì• Import Excel</label>
      <input type="file" id="excelFile" accept=".xlsx,.xls">
    </div>
    <div class="form-group">
      <label for="pdfFile">üìÑ Ack PDF</label>
      <input type="file" id="pdfFile" accept="application/pdf">
    </div>
    <div class="form-group">
      <label for="rackFilter">üóÑ Rack</label>
      <select id="rackFilter"><option value="">All Racks</option></select>
    </div>
    <div class="form-group">
      <label for="searchBox">üîç Search</label>
      <input type="text" id="searchBox" placeholder="Search medicine...">
    </div>
    <div class="form-group">
      <label for="expiryDaysStock">‚è≥ Near Expiry</label>
      <select id="expiryDaysStock">
        <option value="30">30 days</option>
        <option value="60">60 days</option>
        <option value="90">90 days</option>
        <option value="100">100 days</option>
      </select>
    </div>
    <div class="form-group button-group">
      <button onclick="exportExcel()">üìä Excel</button>
      <button onclick="exportPDF()">üìë PDF</button>
    </div>
  </div>
  <table id="medicineTable">
    <thead>
      <tr>
        <th>Medicine Name</th>
        <th>Rack</th>
        <th>Quantity</th>
        <th>Expiry Date</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<!-- ====== NEAR EXPIRY TAB ====== -->
<div id="nearExpiry" class="tab-content">
  <h3>Near Expiry Medicines</h3>
  <div class="controls">
    <div class="form-group">
      <label for="expiryDaysNear">‚è≥ Show expiring within</label>
      <select id="expiryDaysNear">
        <option value="30">30 days</option>
        <option value="60">60 days</option>
        <option value="90">90 days</option>
        <option value="100">100 days</option>
      </select>
    </div>
    <div class="form-group button-group">
      <button onclick="renderNearExpiry()">üîÑ Refresh</button>
      <button onclick="exportNearExpiryExcel()">üìä Excel</button>
      <button onclick="exportNearExpiryPDF()">üìë PDF</button>
    </div>
  </div>
  <table id="nearExpiryTable">
    <thead>
      <tr>
        <th>Medicine Name</th>
        <th>Rack</th>
        <th>Quantity</th>
        <th>Expiry Date</th>
        <th>Days Left</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<!-- ====== QR SCANNER ====== -->
<div id="qr" class="tab-content">
  <button onclick="startQRScanner()">Start Camera Scan</button>
  <div id="qr-reader" style="width:300px; margin-top:15px;"></div>
  <p>Scanned Result: <span id="qrResult"></span></p>
</div>

<!-- ====== REPORTS ====== -->
<div id="reports" class="tab-content">
  <h3>Reports</h3>
  <p>View and download stock & expiry reports.</p>
</div>

</div> <!-- End of Dashboard -->

<script>
// ==== FIREBASE INIT (replace with your config) ====
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_PROJECT.appspot.com",
  messagingSenderId: "SENDER_ID",
  appId: "APP_ID"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();

function login(){
  const email=document.getElementById("loginEmail").value;
  const pass=document.getElementById("loginPassword").value;
  auth.signInWithEmailAndPassword(email,pass).catch(e=>alert(e.message));
}
function logout(){ auth.signOut(); }
auth.onAuthStateChanged(user=>{
  if(user){ document.getElementById("loginSection").style.display="none"; document.getElementById("dashboard").style.display="block";}
  else{ document.getElementById("loginSection").style.display="block"; document.getElementById("dashboard").style.display="none";}
});

// ==== YOUR EXISTING DASHBOARD JS (FEFO, Near Expiry, PDF, QR) ====
// Keep the same code from the final dashboard file we made earlier
// (renderTable, checkExpiry, processPDF, mergeStock, export functions, QR scan logic...)
// Paste your exact existing JS functions here to preserve all features
</script>
</body>
</html>

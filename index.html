<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Smart PHC</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

<!-- External Libraries -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script src="https://unpkg.com/html5-qrcode"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js"></script>

<style>
body{
  font-family:Arial,sans-serif;
  background:#f5fdfc;
  margin:0;
}
.auth-container{
  max-width:360px;margin:80px auto;background:#fff;
  padding:20px;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,0.1);
}
.auth-container input{
  width:100%;padding:8px;margin-bottom:10px;
  border:1px solid #ccc;border-radius:5px;
}
.auth-container button{
  width:100%;padding:10px;
  background:linear-gradient(90deg,#0077b6,#00b894);
  color:#fff;font-weight:bold;border:none;border-radius:5px;cursor:pointer;
}
header{
  background:linear-gradient(90deg,#0077b6,#00b894);
  color:#fff;padding:15px;font-size:20px;font-weight:bold;
  display:flex;justify-content:space-between;align-items:center;
}
#logoutBtn{
  background:#fff;color:#0077b6;border:none;padding:6px 12px;
  border-radius:5px;font-weight:bold;cursor:pointer;
}
/* --- Improved Nav Tabs --- */
nav {
  display: flex;flex-wrap:wrap;
  background: #f6fcfe;
  border-bottom: 1px solid #cdd2d6;
  box-shadow: 0 2px 8px rgba(0,60,110,0.04);
  padding: 0 10px;
}
nav button {
  flex: none;padding: 12px 24px;margin: 0 4px -1px 0;
  font-size: 16px;font-weight: 500;
  color: #226392;background: none;border: none;
  border-radius: 8px 8px 0 0;cursor: pointer;
  transition: background 0.15s, color 0.15s;
  border-bottom: 3px solid transparent;outline: none;
}
nav button.active, nav button:focus {
  background: #fff;color: #006268;
  border-bottom: 3px solid #00b894;font-weight: bold;z-index: 2;
}
nav button:hover:not(.active) {
  background: #e3f6f5;color: #0092b4;
}

.tab-content{display:none;padding:20px;}
.tab-content.active{display:block;}
.alert{
  background:#ffeaa7;padding:10px;margin-bottom:15px;
  border-left:5px solid #fdcb6e;
}
.controls{
  display:flex;flex-wrap:wrap;gap:18px;align-items:flex-end;margin-bottom:15px;
}
.form-group{display:flex;flex-direction:column;}
.form-group label{
  color:#0077b6;font-size:14px;margin-bottom:4px;font-weight:600;
}
input[type="file"],input[type="text"],select{
  border-radius:8px;border:1px solid #b0e2e0;
  padding:6px 10px;font-size:15px;background:#e3f6f5;
}
.button-group{display:flex;gap:8px;}
button{
  border-radius:8px;background:linear-gradient(90deg,#0077b6,#00b894);
  border:none;padding:8px 14px;font-size:14px;font-weight:600;
  cursor:pointer;color:#fff;
}
table{
  width:100%;border-collapse:collapse;background:#fff;
}
th,td{
  border:1px solid #ccc;padding:8px;text-align:center;
}
th{background:#d0f0ec;}
.expired-row{background:lightcoral;color:white;font-weight:bold;}
.near-expiry-row{background:khaki;font-weight:bold;}

/* --- Mobile Responsive --- */
@media (max-width:768px) {
  header {flex-direction: column;gap:8px;text-align:center;}
  nav {justify-content:center;}
  .controls {
    flex-direction: column;align-items:stretch;
  }
  .form-group {width:100%;}
  table {display:block;overflow-x:auto;}
  nav button {flex:1 1 auto;text-align:center;}
}
</style>
</head>
<body>

<!-- Login -->
<div id="loginSection" class="auth-container">
  <h2>Login</h2>
  <input type="email" id="loginEmail" placeholder="Email">
  <input type="password" id="loginPassword" placeholder="Password">
  <button onclick="login()">Login</button>
</div>

<!-- Dashboard -->
<div id="dashboard" style="display:none;">
<header>
  Smart PHC
  <button id="logoutBtn" onclick="logout()">Logout</button>
</header>
<nav>
  <button class="tab-btn active" data-tab="stock">Medicine Stock</button>
  <button class="tab-btn" data-tab="nearExpiry">Near Expiry</button>
  <button class="tab-btn" data-tab="reports">Reports</button>
  <button class="tab-btn" data-tab="qr">QR Scanner</button>
</nav>

<!-- STOCK TAB -->
<div id="stock" class="tab-content active">
  <div class="controls">
    <div class="form-group"><label>Import Excel<input type="file" id="excelFile" accept=".xlsx,.xls"></label></div>
    <div class="form-group"><label>Import PDF<input type="file" id="pdfFile" accept="application/pdf"></label></div>
    <div class="form-group"><label>Rack<select id="rackFilter"><option value="">All</option></select></label></div>
    <div class="form-group"><label>Search<input type="text" id="searchBox" placeholder="Search..."></label></div>
  </div>
  <table id="medicineTable"><thead><tr><th>Medicine</th><th>Rack</th><th>Qty</th><th>Expiry</th></tr></thead><tbody></tbody></table>
</div>

<!-- NEAR EXPIRY TAB -->
<div id="nearExpiry" class="tab-content">
  <div class="alert" id="expiryAlert">No near-expiry medicines.</div>
  <div class="controls">
    <div class="form-group"><label>Show expiring within<select id="expiryDaysNear"><option value="30">30 days</option><option value="60">60 days</option><option value="90">90 days</option><option value="180">180 days</option></select></label></div>
    <div class="form-group button-group"><button onclick="renderNearExpiry()">Refresh</button></div>
  </div>
  <table id="nearExpiryTable"><thead><tr><th>Medicine</th><th>Rack</th><th>Qty</th><th>Expiry</th><th>Status</th></tr></thead><tbody></tbody></table>
</div>

<!-- REPORTS TAB -->
<div id="reports" class="tab-content">
  <div class="controls"><div class="form-group button-group">
    <button onclick="exportExcel()">Export Stock Excel</button>
    <button onclick="exportPDF()">Export Stock PDF</button>
    <button onclick="exportNearExpiryExcel()">Export Near Expiry Excel</button>
    <button onclick="exportNearExpiryPDF()">Export Near Expiry PDF</button>
    <button onclick="exportStockReport()">Export Stock Report Excel</button>
  </div></div>
  <table id="stockReportTable"><thead><tr><th>Medicine</th><th>Rack</th><th>Qty</th><th>Expiry</th></tr></thead><tbody></tbody></table>
</div>

<!-- QR SCANNER TAB -->
<div id="qr" class="tab-content">
  <button onclick="startQRScanner()">Start Scan</button>
  <div id="qr-reader" style="width:300px; margin-top:15px;"></div>
  <p>Result: <span id="qrResult"></span></p>
</div>
</div>

<script>
/* Firebase Config & Auth Logic same as before... */
</script>
</body>
</html>
